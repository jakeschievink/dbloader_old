<!DOCTYPE html>
<html lang="en">
	<head>
   		<meta charset="utf-8">
    		<meta http-equiv="X-UA-Compatible" content="IE=edge">
    		<meta name="viewport" content="width=device-width, initial-scale=1">
    		<title>Bootstrap 101 Template</title>

    		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  	</head>
  	<body>
		<div id="blurred_loading" style="position: fixed;z-index: 1;padding-top: 100px;left: 0; top: 0; width: 100%;height: 100%;overflow: auto;background-color: rgb(0,0,0);background-color: rgba(255,255,255,0.8);">
			<img src="https://mir-s3-cdn-cf.behance.net/project_modules/disp/1f430a36197347.57135ca19bbf5.gif" style="margin-left: auto; margin-right: auto; display: block;">			
		</div>
  		<nav class="navbar navbar-default">
  			<div class="container-fluid">
    				<div class="navbar-header">
      					<a class="navbar-brand" href="#">Dashboard</a>
    				</div>
    				<ul class="nav navbar-nav">
      					<li class="active"><a href="#">Home</a></li>
      					<li><a href="#">Page 1</a></li>
      					<li><a href="#">Page 2</a></li>
      					<li><a href="#">Page 3</a></li>
    				</ul>
				<p id="usb_path" style="margin-right: 5px" class="navbar-text navbar-right">Path</p>
  			</div>
		</nav>

		<div class="container">
    			<ul class="list-group" id="file_group">
    				<li class="list-group-item">Filenames<p style="float:right">All upload<input id="all_upload" type="checkbox"checked></p></li>
    			</ul>
    			
    			<button id="upload" type="button" class="btn btn-success btn-lg">Upload!</button>
    			<button id="setup_dropbox" type="button" class="btn btn-warning btn-lg">Setup dropbox</button>
    			<br><br>
  		</div>
		
    		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
		<script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>
		<script>
			

			var socket;
			var files_length = 0;
			var mount_path;
  			$(function () {

				// getting the socket
    				socket = io();
				
				// check the usb mount and show loading
				check_usb_status(1);

				get_usb_files();
				
  			});

			/*
 			 * Function: check_usb_status(display)
			 * Description: it checks the status of the usb (mounted?)
		  	 * @param display - show the loading when checking
			 */
			function check_usb_status(display) {
				if(display) {
					console.log("Showing loading page");// loading show
					$("#blurred_loading").show();
				} 

				socket.emit('usb', "mount");
				socket.on('usb_mount', function(data) {
					console.log(data.path);
					if(data.stat == 1) {
						if(display) {
							console.log("Removing loading page");
							$("#blurred_loading").hide();
						}

						console.log("Everything okay...");
						$("#usb_path").text(data.path);
					} else {
						console.log("Something went wrong...");
						alert("Something went wrong, check if USB is inserted...");
					}
				});
			}
			
			/*
			 *  Function: get_usb_files()
			 *  Description: act upon the files we have on the usb
			 */
			function get_usb_files() {
							
				socket.emit('files', "get_files");
				socket.on('files', function(data) {
					files_length = (data.array_data).length;					
					for(i=0; i < files_length; i++) {
						if(data.array_data[i] != "") {
							$("#file_group").append('<li class="list-group-item">' + data.array_data[i] + '<p style="float:right">Upload <input type="checkbox" id="'+ i + '"checked></p></li>');
						}
					}
				});
			}
			
			// as the all upload checkbox changes we change all the checkbox states
			$("#all_upload").change(function() {
				check_all_upload($("#all_upload").is(':checked'));
			});
			
			/*
			 * Function: check_all_upload(state)
			 * Description: set the state of all the checkboxes
			 * @param - state -> the state of all the checkboxes
			 */
			function check_all_upload(state) {
				console.log(files_length);
				for(i=0; i < files_length; i++) {
					$("#" + i).prop('checked',state);
				}
			}
			
			
		</script>			
	</body>
</html>
